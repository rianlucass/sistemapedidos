<div id="user-data" data-usuario-id="{{usuario.id}}"></div>

<div class="container mt-4 login-form">
    <div class="row">
        <!-- Banner do restaurante -->
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <img src="" class="rounded-circle" width="100" height="100" alt="Logo">
                    <h1 class="mt-2">{{restaurante.nome}}</h1>
                    <p class="text-muted">{{restaurante.descricao}}</p>
                    <p class="register-link"><a href="/restaurante/perfil">Editar Perfil</a></p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">Pedidos</h3>
            </div>
            <div class="card-body" id="pedidos-container">
                <!-- Aqui serão exibidos os pedidos -->
                <p>Carregando pedidos...</p>
            </div>
        </div>
    </div>
    
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h3 class="mb-0">Ações Rápidas</h3>
                </div>
                <div class="card-body d-grid gap-3">
                    <a href="/restaurante/cardapio" class="btn btn-outline-primary">Gerenciar Cardápio</a>
                    <a href="/restaurante/perfil" class="btn btn-outline-success">Editar Perfil</a>
                </div>
            </div>
        </div>
</div>

<script>
    // Captura o ID do usuário do atributo data-usuario-id
    const userData = document.getElementById("user-data");
    const usuarioId = userData.dataset.usuarioId;

    console.log("ID do usuário:", usuarioId); // Verifique se o ID está correto

    // Função para listar os pedidos
    async function listarPedidosUsuario(usuarioId) {
        try {
            const response = await fetch(`/usuario/pedidos/${usuarioId}`);
            const pedidos = await response.json();

            console.log("Resposta do backend:", pedidos); // Verifique os dados retornados

            const pedidosContainer = document.getElementById("pedidos-container");
            pedidosContainer.innerHTML = ''; // Limpa o conteúdo anterior

            if (!pedidos || pedidos.length === 0) {
                pedidosContainer.innerHTML = '<p>Nenhum pedido encontrado.</p>';
                return;
            }

            pedidos.forEach(pedido => {
                const pedidoElement = document.createElement("div");
                pedidoElement.classList.add("pedido", "mb-3", "p-3", "border", "rounded", "shadow-sm", "bg-light");

                pedidoElement.innerHTML = `
                    <h5 class="mb-2">Pedido #${pedido.id}</h5>
                    <p><strong>Cliente:</strong> ${pedido.nome_cliente}</p>
                    <p><strong>Endereço:</strong> ${pedido.endereco_cliente}</p>
                    <p><strong>Status:</strong> ${pedido.status || "Pendente"}</p>
                    <p><strong>Total:</strong> R$ ${pedido.total.toFixed(2)}</p>
                    <ul class="list-unstyled">
                        ${pedido.itens.map(item => `
                            <li><strong>${item.nome_prato}</strong> - R$ ${item.preco.toFixed(2)} x ${item.quantidade}</li>
                        `).join('')}
                    </ul>
                `;
                pedidosContainer.appendChild(pedidoElement);
            });
        } catch (error) {
            console.error("Erro ao listar pedidos:", error);
            document.getElementById("pedidos-container").innerHTML = '<p>Erro ao carregar pedidos. Tente novamente.</p>';
        }
    }
    // Chama a função para listar os pedidos do usuário
    listarPedidosUsuario(usuarioId);
</script>
